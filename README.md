# 🎬 Online Media Player (在线电影放映室)

一个极简、现代化的在线电影同步放映室。邀请朋友，共享观影时光。

![preview](https://github.com/user-attachments/assets/46691c24-d448-48ab-ba28-b914c46bd08e)

## ✨ 核心特性

### 📺 Bilibili 深度集成 (NEW)
- **极速解析**: 支持 B 站视频链接/BV号解析，自动获取标题、封面、时长、分P信息。
- **MSE 播放优化**: 采用音视频分离下载技术，跳过繁琐的服务器合并步骤，下载完成后**立即播放**。
- **高清画质**: 支持扫码登录 B 站账号，解锁 1080P/1080P60/4K 等高画质。
- **实时进度**: 精确到字节的下载进度显示，实时反馈下载状态。
- **分P支持**: 完美支持 B 站多 P 视频，可自由切换选集。

### 💎 极致体验
- **沉浸式 UI**: 采用 Glassmorphism（玻璃拟态）设计风格，深色影院模式。
- **全平台适配**: 完美适配桌面端、平板及移动端设备。
- **实时弹幕**: Bilibili 风格的弹幕互动，聊天消息自动转化为弹幕。
- **自定义播放器**: 深度定制 Video.js，支持倍速、音量、全屏、画中画等。

### 🚀 高性能播放
- **多格式支持**: MP4, MKV, MOV, FLV, HLS (.m3u8), DASH (.mpd) 等。
- **MSE 技术**: 前端实时合成音视频流，降低服务器 CPU 负载，提升响应速度。
- **字幕支持**: 支持 .srt, .vtt, .ass 字幕即时上传和同步显示。
- **毫秒级同步**: 基于 Socket.io 的精准同步算法，误差控制在毫秒级。

### 🎛️ 播放控制
- **倍速选择**: 0.5x ~ 2.0x 无级倍速调节，多端同步。
- **音轨切换**: 支持多音轨视频的实时切换。
- **同步状态**: 实时显示房间内成员的同步状态（缓冲/就绪）。

### 💬 互动社区
- **实时聊天**: 内置 WebSocket 聊天室。
- **弹幕联动**: 聊天消息自动上屏，无需专门发送弹幕。
- **房间管理**: 权限系统，房主可控制播放进度、切集、字幕等。

### 📺 P2P 屏幕共享 (NEW)
- **浏览器直连**: 基于 WebRTC 的 P2P 屏幕共享，无需服务器中转。
- **OBS 级设置**: 支持分辨率（720p~4K）、帧率（24/30/60）、码率（1~8 Mbps）自定义。
- **国内优化**: 内置腾讯/小米等国内 STUN 服务器，连通性更佳。
- **智能提示**: 连接超时/失败自动提示，方便排查网络问题。

## 🛠️ 技术栈

| 类别 | 技术 | 说明 |
|------|------|------|
| **Frontend** | HTML5, CSS3, JavaScript | 原生开发，无重型框架，极速加载 |
| **Backend** | Node.js, Express | 稳定高效的服务端 |
| **Real-time** | Socket.io v4 | 实时双向通信 |
| **Media** | FFmpeg, Video.js, hls.js | 强大的媒体处理与播放 |
| **Bilibili** | Axios, MSE API | B 站接口对接与流媒体播放 |
| **P2P** | WebRTC, STUN | 屏幕共享与 NAT 穿透 |

## 📦 环境要求

- **Node.js**: v16.0.0+
- **FFmpeg**: 必须安装（用于视频转码和处理）

### 安装 FFmpeg

```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt install ffmpeg

# Windows
# 请前往 ffmpeg.org 下载并配置环境变量
```

## 🚀 快速开始

```bash
# 1. 克隆项目
git clone https://github.com/Entropy-Xu/OnlineMediaPlayer.git
cd OnlineMediaPlayer

# 2. 安装依赖
npm install

# 3. 启动服务器
npm start

# 4. 访问
http://localhost:3000
```

## 🐳 部署指南

### 宝塔面板部署
详细图文教程请查看 👉 **[DEPLOY_BAOTA.md](DEPLOY_BAOTA.md)**

### 常规部署
建议使用 PM2 进行进程守护：
```bash
npm install -g pm2
pm2 start server.js --name "mediaplayer"
```

## ❓ 常见问题

**Q: B 站视频下载速度慢？**
A: 取决于服务器网络环境。如果是海外服务器，下载国内 B 站视频可能会较慢。

**Q: 扫码登录安全吗？**
A: 登录状态（Cookie）仅保存在您的服务器内存中，重启即销毁，不会上传到任何第三方。

**Q: MSE 播放是什么？**
A: Media Source Extensions。我们分别下载 B 站的视频流和音频流，在浏览器端实时合成，这样服务器就不需要消耗 CPU 去合并它们，大大缩短了等待时间。

**Q: 支持多人同时观看吗？**
A: 支持！播放、暂停、跳转、倍速等操作都会在所有观众之间实时同步。

**Q: 屏幕共享连不上怎么办？**
A: 屏幕共享基于 WebRTC P2P 技术，如果提示连接失败/超时，可能是网络环境不支持直连（如企业防火墙、14G/5G 网络）。这种情况需要部署 TURN 服务器来中继流量。

**Q: 屏幕共享的码率设置有什么用？**
A: 码率越高画质越清晰，但占用带宽也越大。建议根据网络情况选择：网络差用 1-2.5 Mbps，网络好用 5-8 Mbps。

## 🤝 贡献

欢迎提交 Issue 或 Pull Request！致力于打造最好用的在线放映室。

## 📄 许可证

[GPL-3.0](LICENSE) - 开源与自由。
